<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>iOS屏幕旋转适配 | 程序员的自我修养</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="屏幕旋转适配前言现在大部分的智能移动设备通过自动旋转，能够自动切换去呈现最适合当前屏幕显示的内容，无疑大大提升了使用者的用户体验。不过作为开发者，想要达到完美的适配效果，还是要下一番功夫钻研尝试才能做得的。笔者就根据自己适配屏幕自动旋转的工作经验，在此做一点总结。
硬件原理为了检测设备（最关键的就是面子——屏幕）当前在三维空间中的朝向，现在的智能设备都内置了加速计。这一部分我完全照抄了来源【1】：">
<meta property="og:type" content="article">
<meta property="og:title" content="iOS屏幕旋转适配">
<meta property="og:url" content="http://yoursite.com/2016/06/01/iOS屏幕旋转适配/index.html">
<meta property="og:site_name" content="程序员的自我修养">
<meta property="og:description" content="屏幕旋转适配前言现在大部分的智能移动设备通过自动旋转，能够自动切换去呈现最适合当前屏幕显示的内容，无疑大大提升了使用者的用户体验。不过作为开发者，想要达到完美的适配效果，还是要下一番功夫钻研尝试才能做得的。笔者就根据自己适配屏幕自动旋转的工作经验，在此做一点总结。
硬件原理为了检测设备（最关键的就是面子——屏幕）当前在三维空间中的朝向，现在的智能设备都内置了加速计。这一部分我完全照抄了来源【1】：">
<meta property="og:image" content="http://yoursite.com/2016/06/01/iOS屏幕旋转适配/device_orientation.png">
<meta property="og:image" content="http://yoursite.com/2016/06/01/iOS屏幕旋转适配/app_config.png">
<meta property="og:updated_time" content="2016-06-01T13:54:42.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="iOS屏幕旋转适配">
<meta name="twitter:description" content="屏幕旋转适配前言现在大部分的智能移动设备通过自动旋转，能够自动切换去呈现最适合当前屏幕显示的内容，无疑大大提升了使用者的用户体验。不过作为开发者，想要达到完美的适配效果，还是要下一番功夫钻研尝试才能做得的。笔者就根据自己适配屏幕自动旋转的工作经验，在此做一点总结。
硬件原理为了检测设备（最关键的就是面子——屏幕）当前在三维空间中的朝向，现在的智能设备都内置了加速计。这一部分我完全照抄了来源【1】：">
<meta name="twitter:image" content="http://yoursite.com/2016/06/01/iOS屏幕旋转适配/device_orientation.png">
  
    <link rel="alternate" href="/atom.xml" title="程序员的自我修养" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">程序员的自我修养</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-iOS屏幕旋转适配" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/06/01/iOS屏幕旋转适配/" class="article-date">
  <time datetime="2016-06-01T12:21:03.000Z" itemprop="datePublished">2016-06-01</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      iOS屏幕旋转适配
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="屏幕旋转适配"><a href="#屏幕旋转适配" class="headerlink" title="屏幕旋转适配"></a>屏幕旋转适配</h1><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>现在大部分的智能移动设备通过自动旋转，能够自动切换去呈现最适合当前屏幕显示的内容，无疑大大提升了使用者的用户体验。不过作为开发者，想要达到完美的适配效果，还是要下一番功夫钻研尝试才能做得的。笔者就根据自己适配屏幕自动旋转的工作经验，在此做一点总结。</p>
<h2 id="硬件原理"><a href="#硬件原理" class="headerlink" title="硬件原理"></a>硬件原理</h2><p>为了检测设备（最关键的就是面子——屏幕）当前在三维空间中的朝向，现在的智能设备都内置了加速计。这一部分我完全照抄了来源【1】：</p>
<p>通过感知特定方向的惯性力总量，加速计可以测量出加速度和重力，ios设备内的加速计是一个三轴加速计，这意味着它能够检测出三维空间中的运动或重力引力。因此加速计不但可以指示握持电话的方式（如自动旋转功能），而且如果电话放在桌子上的话还可以指示电话的正面朝上还是朝下。</p>
<p>加速计可以测量g引力（g代表重力），因此加速计返回值为1.0时，表示在特定的方向上感知到1g。</p>
<ul>
<li>如果是静止握持iphone而没有任何运动，那么地球引力对其施加的力大约为1g</li>
<li>如果是纵向竖直握持，那么设备会检测并报告在其y轴上施加的力大约为1g </li>
<li>如果是以一定的角度握持，那么1g的力会分布到不同的轴上，这取决于握持的方式，在以45度握持时，1g的力会均匀的分解到两个轴上。如果检测到加速计值远大于1g，那么可以判断是突然运动，，正常使用时加速计在任何一个轴上都不会检测到远大于1g的值，如果摇动、坠落或投掷设备，那么加速计便会在一个或多个轴上检测到很大的力。</li>
</ul>
<p>下图所示加速计所使用的三轴结构<br><img src="/2016/06/01/iOS屏幕旋转适配/device_orientation.png" alt="Orientation of the device axes" title="Orientation of the device axes"></p>
<p>当然，如今的智能手机里往往不光内置了加速计，往往还有陀螺仪。这一方面的知识就由大家自行去挖掘吧，很多游戏都是利用它去实现很自然的操作感。</p>
<h2 id="软件适配"><a href="#软件适配" class="headerlink" title="软件适配"></a>软件适配</h2><h3 id="朝向定义"><a href="#朝向定义" class="headerlink" title="朝向定义"></a>朝向定义</h3><p>既然硬件能获取到当前屏幕的朝向，苹果的SDK也一定会为开发者提供接口指定有哪些朝向可选，以及如何获取到当前朝向。在 UIDevice.h 以及 UIApplication.h 中可见其定义如下：</p>
<p><strong>7种设备朝向：</strong></p>
<pre><code>typedef NS_ENUM(NSInteger, UIDeviceOrientation) {
    UIDeviceOrientationUnknown,
    UIDeviceOrientationPortrait,            // Device oriented vertically, home button on the bottom
    UIDeviceOrientationPortraitUpsideDown,  // Device oriented vertically, home button on the top
    UIDeviceOrientationLandscapeLeft,       // Device oriented horizontally, home button on the right
    UIDeviceOrientationLandscapeRight,      // Device oriented horizontally, home button on the left
    UIDeviceOrientationFaceUp,              // Device oriented flat, face up
    UIDeviceOrientationFaceDown             // Device oriented flat, face down
} __TVOS_PROHIBITED;
</code></pre><p><strong>5种界面朝向：</strong></p>
<pre><code>// Note that UIInterfaceOrientationLandscapeLeft is equal to UIDeviceOrientationLandscapeRight (and vice versa).
// This is because rotating the device to the left requires rotating the content to the right.
typedef NS_ENUM(NSInteger, UIInterfaceOrientation) {
    UIInterfaceOrientationUnknown            = UIDeviceOrientationUnknown,
    UIInterfaceOrientationPortrait           = UIDeviceOrientationPortrait,
    UIInterfaceOrientationPortraitUpsideDown = UIDeviceOrientationPortraitUpsideDown,
    UIInterfaceOrientationLandscapeLeft      = UIDeviceOrientationLandscapeRight,
    UIInterfaceOrientationLandscapeRight     = UIDeviceOrientationLandscapeLeft
} __TVOS_PROHIBITED;
</code></pre><p>二者的值也是可以对应得上。</p>
<h3 id="朝向获取和设置"><a href="#朝向获取和设置" class="headerlink" title="朝向获取和设置"></a>朝向获取和设置</h3><p>有了朝向的定义，该如何获取当前的朝向取值呢？<br>如果是要获取设备朝向，可以直接通过 UIDevice 实例的属性</p>
<pre><code>// return current device orientation.  this will return UIDeviceOrientationUnknown unless device orientation notifications are being generated.
@property(nonatomic,readonly) UIDeviceOrientation orientation __TVOS_PROHIBITED;       
</code></pre><p>需要注意注释的内容，也就是必须首先在 UIDevice 朝向通知生成之后才可以正常获取朝向数据。</p>
<p>也就是要监听UIDevice抛出的系统通知 UIDeviceOrientationDidChangeNotification</p>
<pre><code>[[NSNotificationCenter defaultCenter]addObserver:self 
selector:@selector(updateOrientation:) 
name:UIDeviceOrientationDidChangeNotification object:nil];
</code></pre><p>不过这里其实有一点小坑，那就是还有一对关键的接口苹果没有直接告诉你，那就是</p>
<pre><code>- (void)beginGeneratingDeviceOrientationNotifications __TVOS_PROHIBITED;      // nestable
- (void)endGeneratingDeviceOrientationNotifications __TVOS_PROHIBITED;
</code></pre><p>必须要在调用前者之后，才会在每次设备朝向变化时触发 UIDeviceOrientationDidChangeNotification 通知。<br>不过没有必要的话，也要及时调用后者去结束对加速计数据的获取，默默的为用户电池续航助力。</p>
<hr>
<p>类似的，也同样可以通过监听下面两个通知去获取UIInterfaceOrientation的变化：</p>
<pre><code>UIKIT_EXTERN NSString *const UIApplicationWillChangeStatusBarOrientationNotification __TVOS_PROHIBITED; // userInfo contains NSNumber with new orientation
UIKIT_EXTERN NSString *const UIApplicationDidChangeStatusBarOrientationNotification __TVOS_PROHIBITED;  // userInfo contains NSNumber with old orientation
</code></pre><p>二者的差异关键是在notification的userInfo中携带的值，一个是新的朝向，一个是旧的朝向，可不要搞反了哦。</p>
<p>再有是通过UIApplication的下面这个属性也可以获取界面朝向。</p>
<pre><code>// Explicit setting of the status bar orientation is more limited in iOS 6.0 and later.
@property(readwrite, nonatomic) UIInterfaceOrientation statusBarOrientation NS_DEPRECATED_IOS(2_0, 9_0) __TVOS_PROHIBITED;
</code></pre><hr>
<p>另外，某些应用场景下，还需要去手动设置屏幕旋转，比如播放器往往都既支持自动旋转屏幕去切换全屏播放，也支持手动切换。但翻看了半天API描述和文档，要么就是不提供接口，要么就是警告设置受限，那要怎么做呢？其实很简单，只要两行代码搞定：</p>
<pre><code>NSNumber *value = @(UIInterfaceOrientationPortrait);//或者别的想要的值
[[UIDevice currentDevice] setValue:value forKey:@&quot;orientation&quot;];
</code></pre><h3 id="App及页面适配"><a href="#App及页面适配" class="headerlink" title="App及页面适配"></a>App及页面适配</h3><p>App中全局配置支持朝向的地方，最方便的就是在工程的Target中了，如图所示：</p>
<img src="/2016/06/01/iOS屏幕旋转适配/app_config.png" alt="App全局配置" title="App全局配置">
<h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><p>【1】<a href="http://blog.csdn.net/lv_ruanruan/article/details/19899103" target="_blank" rel="external">ios 关于屏幕旋转和屏幕晃动</a></p>
<p>【2】<a href="http://www.jianshu.com/p/d8018006f0b5" target="_blank" rel="external">iOS指定页面屏幕旋转，手动旋转（某app实现功能全过程）</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/06/01/iOS屏幕旋转适配/" data-id="ciowxqe6h0003lgpbbdx0ty8l" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/iOS/">iOS</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/屏幕旋转/">屏幕旋转</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
  
    <a href="/2016/06/01/Hello-World-0/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Hello World</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/iOS/">iOS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/屏幕旋转/">屏幕旋转</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/无病呻吟/">无病呻吟</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/iOS/" style="font-size: 10px;">iOS</a> <a href="/tags/屏幕旋转/" style="font-size: 10px;">屏幕旋转</a> <a href="/tags/无病呻吟/" style="font-size: 10px;">无病呻吟</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/06/">June 2016</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2016/06/01/iOS屏幕旋转适配/">iOS屏幕旋转适配</a>
          </li>
        
          <li>
            <a href="/2016/06/01/Hello-World-0/">Hello World</a>
          </li>
        
          <li>
            <a href="/2016/06/01/开篇/">(no title)</a>
          </li>
        
          <li>
            <a href="/2016/06/01/hello-world/">Hello World</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2016 Wayne Wei<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>